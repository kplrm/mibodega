
        <h3>Seleccione su bodega</h3>
        <p><br></p>
        <label for="bodega_name">Bodega:</label>
        <input type="text" class="form-control" id="bodega_name" value="Cercanas" disabled>
        <p><br></p>
        <input type="hidden" class="form-control" id="bodega_id" value="Cercanas" disabled> <!--change to type hidden to hide-->
        
        <div id="mapid"></div>
        <script type = "text/javascript">
            // Initializes map
            var map = L.map('mapid').setView([ -12.046374, -77.0427934 ], 14);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            const customMarkerIcon = L.AwesomeMarkers.icon({
                "extraClasses": "fa-rotate-0", 
                "icon": "shopping-cart", 
                "iconColor": "white", 
                "markerColor": "orange", 
                "prefix": "glyphicon"
            });	

            // Get user geolocation
            function showLocation(position) {
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;
                map.panTo(new L.LatLng(latitude, longitude));
                // Request for shops nearby user
                $.ajax({
                    headers: {'X-CSRFToken': '{{ csrf_token }}'},
                    url: "/get_nearby_shops",
                    type: "POST",
                    dataType: "json",
                    data: {
                        'latitude': latitude,
                        'longitude': longitude
                    },
                    success: function(response){ // make a marker at the shops nearby
                        console.log(response);
                        var bd_name = []
                        var bd_id = []
                        for (i = 0; i < response.success.length; i++) {
                            bd_name.push(response.success[i][2]);
                            bd_id.push(response.success[i][3]);
                            var marker = L.marker([ response.success[i][0],response.success[i][1] ], {
                            icon: customMarkerIcon
                        }).addTo(map)
                            .bindPopup( bd_name[i] )
                            .closePopup()
                            .on('click', function onClick(shop) {
                                document.getElementById("bodega_name").value = bd_name[i];
                                document.getElementById("bodega_id").value = bd_id[i];
                            });
                        };
                    },
                    error: function(response){ // This triggers in case all items in the basket get unavailable
                        console.log(response);
                    }
                });
            }
            function errorHandler(err) {
                if(err.code == 1) {
                alert("Error: Access is denied!");
                } else if( err.code == 2) {
                alert("Error: Position is unavailable!");
                }
            }
            function getLocation() {
                if(navigator.geolocation) {
                // timeout at 60000 milliseconds (60 seconds)
                var options = {timeout:60000};
                navigator.geolocation.getCurrentPosition(showLocation, errorHandler, options);
                } else {
                alert("Sorry, browser does not support geolocation!");
                }
            }
        </script>