
<a class="btn modal-trigger" id="user_location_btn" data-target="user_location_modal" onclick="getLocation()" style="padding:0px 0px 0px 0px;background-color:#ffffff;box-shadow:none;">
    <i class="material-icons" style="Margin:-10px 0px 0px 0px;">place</i>
</a>

<!-- Modal -->
<div id="user_location_modal" class="modal modal-fixed-footer">
    <div class="modal-content"> <!-- style="padding: 7px 7px 7px 7px;" -->
        <h4>¿Dónde estás?</h4><br>
        {% include 'main/includes/select_shop.html' %}
    </div>
    <div class="modal-footer">
        <a class="btn" onclick="getLocation()" name="buy_btn" id="buy_btn" style="padding:0px 10px 0px 10px;background-color:#feb100;">
            <i class="material-icons" style="Margin:-10px 0px 0px 0px;">location_searching</i>
        </a>
    </div>
</div>
<script>
    // On modal closed event listener
    document.addEventListener('DOMContentLoaded', function() {
        var elems = document.getElementById('user_location_modal');
        var instances = M.Modal.init(elems, {onCloseEnd: function() {
            latitude = document.getElementById("usr_lat").value;
            longitude = document.getElementById("usr_lng").value;
            $.ajax({
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                url: "/",
                type: "POST",
                dataType: "json",
                data: {
                    'latitude': latitude,
                    'longitude': longitude
                },
                success: function(response){ 
                    location.reload;
                },
                error: function(response){ // This triggers in case all items in the basket get unavailable
                    location.reload;
                }
            });
        }});
    });
    

    /*
    $(document).ready(function(){
        $("#exampleModalCenter").on('shown.bs.modal', function () {
            setTimeout(function() {
                map.invalidateSize();
            }, 10);
        });
        $("#anular-seleccion").click(function(){
            $('#bodega_name').val('Cercanas');
            $('#bodega_id').val('Cercanas');
        });
        $("#modal-save").click(function(){
            $("#exampleModalCenter").modal("hide");
            $('.modal-backdrop').hide();
            $.ajax({
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                url: "/save_store_location",
                type: "POST",
                dataType: "json",
                data:   {
                            'bodega_name': $('#bodega_name').val(),
                            'id_bodega': $('#bodega_id').val()
                        },
                success: function(response){
                    alert ("resp: "+response);
                }
            });
            $.ajax({
                url: "/embutidos",
                type: "GET",
                success: function(){
                    location.reload();
                }
            });
        });
    });*/
</script>