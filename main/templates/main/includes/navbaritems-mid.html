{% load static %}

    <!-- MIDDLE BAR MATERIALIZE -->
    <div class="nav-wrapper" style="background-color:#ffffff;">
        <div class="row" style="margin-bottom:0px;">
            <div class="col xl1 l1 m1 s2" style="flex-basis:auto;padding:0px 0px 0px 0px;">
                <a href="#" data-target="slide-out" class="sidenav-trigger" style="color:black"><i class="material-icons">menu</i></a>
            </div>
            <div class="col xl2 l3 m3 hide-on-small-only" style="flex-basis:auto;">
                <a href = "/"><img class="responsive-img" style="max-width:150px;" src="{% static 'main/img/logo.png' %}" alt="LOGO"></a>
            </div>
            <div class="col xl8 l7 m7 s8" style="flex-basis:auto;">
                <div class="input-field">
                    <style>
                        @media only screen and (max-width: 600px) {
                            .search_bar {
                                width:calc(100% - 0rem) !important;padding:0px 0px 0px 0px !important;
                            }
                        }
                        @media only screen and (min-width: 601px) {
                            .search_bar {
                                width:100% !important;padding:0px 0px 0px 0px !important;
                            }
                        }
                    </style>
                    <form method="GET" action="/see_search_results" id="search_query_form" style="Margin: 10px 0px 0px 0px;">
                        <input class="search_bar" name="search-product" id="search-product" type="search" oninput="search_product(this.value)" placeholder="¿Qué estás buscando?" style="max-width:100%;height:40px;z-index:10;">
                    </form>
                </div>
                <div id="search-preloader" style="height:auto;display:none;z-index:10;position:fixed;left:0;right:0;box-sizing:border-box;box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12), 0 1px 5px 0 rgba(0, 0, 0, 0.2);">
                    <div style="background-color:#ffffff;width:100%;text-align: -webkit-center;">
                        <div class="loader" id="loader_circle"></div>
                        <div>
                            <table id="result_table">
                            </table>
                        </div>
                    </div>
                </div>
                <!--<div class="input-field col s12">
                    <i class="material-icons prefix">search</i>
                    <input type="text" id="autocomplete-input" class="autocomplete">
                    <label for="autocomplete-input">Autocomplete</label>
                </div>-->
            </div>
            <div class="col xl1 l1 m1 s2" style="flex-basis:auto;">
                {% include 'main/includes/shop_selection.html' %}
            </div>
        </div>
    </div>

    <script>
    // Function to show search-preloader
    function show_search_preloader() {
        $("#search-preloader").css("display", "block");
        $("#search-preloader").css("opacity", 1);
        $("#loader_circle").show();
    }
    // Function to hide search-preloader
    function close_search_preloader() {
        $("#search-preloader").css("display", "none");
        $("#search-preloader").css("opacity", 0);
    }
    // Perform search-product query
    function search_product(search_text) {
        if (search_text != "" && search_text.length > 2) {
            $.ajax({
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                url: "/search_query",
                type: "POST",
                dataType: "json",
                data: {
                    search_text: search_text
                },
                beforeSend: function() {
                    show_search_preloader();
                },
                success: function(response){
                    $("#loader_circle").hide();
                    var result_dict = JSON.parse(response.success);
                    $('#result_table').html('');
                    if (result_dict.length == 0) {
                        $('#result_table').append('<tr><td colspan="4" style="text-align:center;"><h5 style="color:#ff2322;">Este producto no está disponible en su zona.</h5></td></tr>');
                    }
                    for (i = 0; i < result_dict.length; i++) {
                        $('#result_table').append('<tr><td style="text-align:center;"><img class="responsive-img" style="max-width:50px;" src="'+result_dict[i][1][1]+'" alt="img"></td><td style="text-align:left;"><p style="line-height:1.4;">'+result_dict[i][1][0]+'</p></td><td style="text-align:right;"><b style="font-size:18px;color:#feb100"> S/.'+parseFloat(result_dict[i][1][2]).toFixed(2)+'</b></td><td style="padding: 0px 5px 0px 5px;text-align:right;"><a class="btn" name="cart_add" id="'+result_dict[i][0]+'" onclick="cart_add(this)" style="background-color:#feb100;padding:0px 10px 0px 10px;"><i class="material-icons" style="margin-top:-9px;">add_shopping_cart</i></a></td></tr>');
                    };
                    $('#result_table').append('<tr><td colspan="3" style="text-align:center;"><a class="btn waves-effect waves-light" onclick="see_search_results(\''+search_text+'\')" style="background-color:#feb100 !important;color:#000000;font-weight:bold;">Ver más resultados</a></td><td colspan="1" style="padding: 0px 5px 0px 5px;text-align:right;"><a class="btn waves-effect waves-light red lighten-5" onclick="close_search_preloader()" style="padding:0px 10px 0px 10px;"><i class="material-icons" style="margin-top:-9px;">close</i></a></td></tr>');
                },
                error: function(){
                    $("#loader_circle").hide();
                    location.reload();
                }
            });
        } else {
            close_search_preloader();
        }
    };
    // Redirect to search results
    function see_search_results(search_text) {
        if (search_text != "" && search_text.length > 2) {
            document.getElementById("search_query_form").submit();
        } else {
            close_search_preloader();
        }
    };
    </script>