{% load static %}

    <!-- MIDDLE BAR MATERIALIZE -->
    <div class="nav-wrapper" style="background-color:#ffffff;">
        <div class="row" style="margin-bottom:0px;">
            <div class="col xl1 l1 m1 s2" style="flex-basis:auto;padding:0px 0px 0px 0px;">
                <a href="#" data-target="slide-out" class="sidenav-trigger" style="color:black"><i class="material-icons">menu</i></a>
            </div>
            <div class="col xl2 l3 m3 hide-on-small-only" style="flex-basis:auto;">
                <a href = "/"><img class="responsive-img" style="max-width:150px;" src="{% static 'main/img/logo.png' %}" alt="LOGO"></a>
            </div>
            <div class="col xl8 l7 m7 s8" style="flex-basis:auto;">
                <form style="Margin: 10px 0px 0px 0px;">
                    <div class="input-field">
                        <!--<input class="hide-on-small-only" id="search" type="search" required placeholder="What are you looking for?" style="max-width:100%;height:40px;width:calc(100% - 7rem);">-->
                        <input class="hide-on-small-only" id="search-product" type="search" onkeyup="search_product(this.value)" onsearch="onSearchMethod(this.value)" placeholder="¿Qué estás buscando?" style="max-width:100%;height:40px;width:calc(100% - 7rem);z-index:10;">
                        <input class="hide-on-med-and-up" id="search-product" type="search" onkeyup="search_product(this.value)" onsearch="onSearchMethod(this.value)" placeholder="¿Qué estás buscando?" style="max-width:100%;height:40px;width:100%;padding:0px 0px 0px 0px;z-index:10;">
                        <!--<label class="label-icon hide-on-small-only" for="search-product"><i class="material-icons" style="Margin: -7px 0px 0px 0px;">search</i></label>
                        <i class="material-icons hide-on-small-only" style="Margin:-7px 0px 0px 0px;">close</i>-->
                    </div>
                    <div id="search-preloader" style="height:auto;display:none;z-index:10;position:fixed;left:0;right:0;box-sizing:border-box;">
                        <div style="background-color:#ffffff;width:100%;text-align: -webkit-center;">
                            <div class="loader" id="loader_circle"></div>
                            <div>
                                <table id="result_table">
                                </table>
                            </div>
                        </div>
                    </div>
                    <!--<div class="input-field col s12">
                        <i class="material-icons prefix">search</i>
                        <input type="text" id="autocomplete-input" class="autocomplete">
                        <label for="autocomplete-input">Autocomplete</label>
                    </div>-->
                </form>
            </div>
            <div class="col xl1 l1 m1 s2" style="flex-basis:auto;">
                {% include 'main/includes/shop_selection.html' %}
            </div>
        </div>
    </div>

    <script>
    // Function to show search-preloader
    function show_search_preloader() {
        $("#search-preloader").css("display", "block");
        $("#search-preloader").css("opacity", 1);
        $("#loader_circle").show();
    }
    // Function to hide search-preloader
    function close_search_preloader() {
        $("#search-preloader").css("display", "none");
        $("#search-preloader").css("opacity", 0);
    }
    // Triggered when clicked enter or the x
    function onSearchMethod(value) {
        console.log(value);
        if (value = ""){
            close_search_preloader();
        }
    }
    // Perform search-product query
    function search_product(search_text) {
        if (search_text != "" && search_text.length > 2) {
            $.ajax({
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                url: "/search_query",
                type: "POST",
                dataType: "json",
                data: {
                    search_text: search_text
                },
                beforeSend: function() {
                    show_search_preloader();
                },
                success: function(response){
                    $("#loader_circle").hide();
                    console.log('El exitoooo');
                    var result_dict = JSON.parse(response.success);
                    console.log(result_dict);
                    $('#result_table').html('');
                    for (i = 0; i < result_dict.length; i++) {
                        console.log(result_dict[i][1])
                        $('#result_table').append('<tr><td><img class="responsive-img" style="max-width:50px;" src="'+result_dict[i][1][1]+'" alt="img"></td><td><p style="line-height:1.4;">'+result_dict[i][1][0]+'</p></td><td><a class="btn" name="cart_add" id="'+result_dict[i][0]+'" onclick="cart_add(this)" style="background-color:#feb100;padding:0px 10px 0px 10px;"><i class="material-icons" style="margin-top:-9px;">add_shopping_cart</i></a></td></tr>');
                    };
                    $('#result_table').append('<tr><td colspan="3" style="text-align:center;"><a href="#" class="btn waves-effect waves-light" style="background-color:#feb100 !important;color:#000000;font-weight:bold;">Ver más resultados</a></td></tr>');
                    //product_row = document.getElementsByName(String(product.id));
                    //$("#total_cart_price").html('S/.'+parseFloat(new_total_price).toFixed(2));
                },
                error: function(){
                    $("#loader_circle").hide();
                    console.log('Siguie intentando');
                    //location.reload();
                    ;
                }
            });
        } else {
            close_search_preloader();
        }
    /*
        // Print remove current results and add new search results
        $("tr").remove(".c_products_to_add");
        {% for product_faltante in ProductosAprobados_missing %}
            for (i = 0; i < product_faltante.length; i++) {
                if (String("{{ product_faltante.pa_ID }}") == String(product_faltante[i].id)) {
                    $("#products_to_add_container").append('<tr name="missing_products" class="c_products_to_add"><td><input type="checkbox" name="item_to_add" id="'+String(product_faltante[i].id)+'" class="form-check-input"></td><td><div class="m-r-10"><img src="'+String(product_faltante[i].img)+'" alt="IMG" class="rounded" width="45"></div></td><td>'+String(product_faltante[i].product)+'</td><td>'+String(product_faltante[i].brand)+'</td></tr>');
                }
            }
        {% endfor %}
        */
    };
    </script>